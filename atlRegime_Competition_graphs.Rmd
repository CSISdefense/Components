---
title: "CompetitionATLregime"
author: "Greg Sanders"
date: "Friday, March 20, 2015"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Setup, echo=FALSE}
require(ggplot2)
require(stringr)
require(plyr)
require(lubridate)

options(error=recover)
# Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
Path<-"C:\\Users\\Greg Sanders\\SkyDrive\\Documents\\R Scripts and Data SkyDrive\\"
# setwd("K:/Development/Components")
source(paste(Path,"lookups.r",sep=""))
source(paste(Path,"helper.r",sep=""))

axis.text.size<-14
        strip.text.size<-12
        legend.text.size<-8
        # table.text.size<-5.75
        title.text.size<-12
        geom.text.size<-12
        
        main.text.size<-2
        note.text.size<-1.40
```

You can also embed plots, for example:

```{r DateEntryAndProcessing, echo=FALSE}
## ("Data\\defense_summary_SP_CompetitionHistoryBucketSubCustomerRegime.csv", sep = """) Neither the computer nor myself can find this file in (K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\Data)

RawRegime  <- read.csv(
    unz("Data\\Defense_Summary_SP_CompetitionVehicleHistoryBucketSubCustomerRegime.zip",
        "Defense_Summary_SP_CompetitionVehicleHistoryBucketSubCustomerRegime.csv"),
#     "Data\\defense_summary_SP_CompetitionHistoryBucketSubCustomerRegime.csv",
    header = TRUE, sep = ",", dec = ".", strip.white = TRUE, 
    na.strings = c("NULL","NA",""),
    stringsAsFactors = TRUE
    )

RawRegime<-apply_lookups(Path,RawRegime)
names(RawRegime)
str(RawRegime)
RawRegime$USDATL<-factor(RawRegime$USDATL,levels=c("GANSLER+","ALDRIDGE","WYNNE","KRIEG","YOUNG", "CARTER","KENDALL" ),ordered=TRUE )
RawRegime<-subset(RawRegime,USDATL %in% c("YOUNG","CARTER","KENDALL"))


Coloration<-read.csv(
    paste(Path,"Lookups\\","lookup_coloration.csv",sep=""),
    header=TRUE, sep=",", na.strings="", dec=".", strip.white=TRUE, 
    stringsAsFactors=FALSE
    )

Coloration<-ddply(Coloration
                  , c(.(R), .(G), .(B))
                  , transform
                  , ColorRGB=as.character(
                      if(min(is.na(c(R,G,B)))) {NA} 
                      else {rgb(max(R),max(G),max(B),max=255)}
                      )
                  )

# debug(LatticePercentLineWrapper)
RawRegime$Graph<-TRUE

RawRegime$SignedQuarter<-as.Date(paste(as.numeric(format(RawRegime$SignedMonth, "%Y"))+
                                                  floor(as.numeric(format(RawRegime$SignedMonth,"%m"))/10),
    (floor((as.numeric(format(RawRegime$SignedMonth, "%m"))-1)/3)*3+4) %% 12,
    1
      ,sep="-"),"%Y-%m-%d")-1

RawRegime$SubCustomer.component<-droplevels(RawRegime$SubCustomer.component)
RawRegime$SubCustomer.component<-factor(RawRegime$SubCustomer.component,
                                               levels=c("Army","Navy","Air Force","DLA",
                                                        "MDA","MilitaryHealth","Additional DoD Components"),
                                               ordered=TRUE)
                                              
#Add quarters
RawRegime$Quarter[month(RawRegime$SignedMonth) %in% c(10:12)] <- "Q1" 
RawRegime$Quarter[month(RawRegime$SignedMonth) %in% c(1:3)] <- "Q2" 
RawRegime$Quarter[month(RawRegime$SignedMonth) %in% c(4:6)] <- "Q3" 
RawRegime$Quarter[month(RawRegime$SignedMonth) %in% c(7:9)] <- "Q4" 
RawRegime$Quarter<-factor(RawRegime$Quarter,
                                     levels=c("Q1","Q2","Q3","Q4"),
                                     ordered=TRUE)

```


```{r CompATLregime}
ATLregimeFYear<-aggregate(RawRegime$Obligation.2014
                          , by=list(RawRegime$Fiscal.Year,
                                    #                                                   RawRegime$SubCustomer.component,
                                    RawRegime$USDATL)
                          ,FUN = "sum"
                          ,na.rm =TRUE
                          )

names(ATLregimeFYear)<-c("Fiscal.Year","USDATL","AnnualRegimeObligations")


USDATL<-subset(RawRegime,join(RawRegime,ATLregimeFYear)$AnnualRegimeObligations>=50)


ATLregimeDetails<-data.frame(USDATL= 'GANSLER+',
                             StartDate=as.Date('1997/11/10',format='%Y/%m/%d'),
                             EndDate=as.Date('2001/05/10',format='%Y/%m/%d'))
ATLregimeDetails<-rbind(ATLregimeDetails,data.frame(USDATL= 'ALDRIDGE',
                                                    StartDate=as.Date('2001/05/10',format='%Y/%m/%d'),
                                                    EndDate=as.Date('2003/05/22' ,format='%Y/%m/%d') ))
ATLregimeDetails<-rbind(ATLregimeDetails,data.frame(USDATL= 'WYNNE',
                                                    StartDate=as.Date('2003/05/23' ,format='%Y/%m/%d'),
                                                    EndDate=as.Date('2005/06/05' ,format='%Y/%m/%d')))
ATLregimeDetails<-rbind(ATLregimeDetails,data.frame(USDATL= 'KRIEG',
                                                    StartDate=as.Date('2005/06/06' ,format='%Y/%m/%d'),
                                                    EndDate=as.Date('2007/07/19' ,format='%Y/%m/%d')))
ATLregimeDetails<-rbind(ATLregimeDetails,data.frame(USDATL= 'YOUNG',
                                                    StartDate=as.Date('2007/07/20' ,format='%Y/%m/%d'),
                                                    EndDate=as.Date('2009/04/26',format='%Y/%m/%d')))
ATLregimeDetails<-rbind(ATLregimeDetails,data.frame(USDATL= 'CARTER',
                                                    StartDate=as.Date('2009/04/27',format='%Y/%m/%d'),
                                                    EndDate=as.Date('2011/11/02',format='%Y/%m/%d')))
ATLregimeDetails<-rbind(ATLregimeDetails,data.frame(USDATL= 'KENDALL' ,
                                                    StartDate=as.Date('2011/11/03',format='%Y/%m/%d'),
                                                    EndDate=max(RawRegime$SignedQuarter)))


ATLregimeDetails$StartFiscalYear<-ymd(paste(year(ATLregimeDetails$StartDate)+
                                                ifelse(month(ATLregimeDetails$StartDate)<10,-1,0)
                                            ,"-10-1",sep=""))


USDATL<-join(USDATL,ATLregimeDetails,match="first")

USDATL$Fiscal.Year[USDATL$Fiscal.Year>USDATL$EndDate&
                                      USDATL$SignedMonth<=USDATL$EndDate]<-
    USDATL$EndDate[USDATL$Fiscal.Year>USDATL$EndDate&
                                      USDATL$SignedMonth<=USDATL$EndDate]

USDATL$Fiscal.Year[USDATL$Fiscal.Year<USDATL$StartDate]<-
    USDATL$StartDate[USDATL$Fiscal.Year<USDATL$StartDate]

```

```{r USDATLmonthlyComponents}        
    
png(
    paste( "Output\\Competition\\",paste("DoD_components"
                                         ,"Obligation_2014"
                                         ,"Competition_sum"
                                         ,"USDATL"
                                         ,"6monthMovingAverage"
                                         ,sep="_"
                                         )
           ,".png"
           , sep=""
           )
    , type="cairo"
    , width=7.5
    , height=10
    , units='in'
    , pointsize=12
    , res=150
    )

# debug(LatticePercentLineWrapper)

CompGraph<-LatticePercentLineWrapper(
    "Competition"
    ,""#Competition by DoD Component and Starting Regime"
    ,"Month of Obligation (6 Month Lagging Average)"
    ,"% of Component Obligations"
    ,Coloration
    ,USDATL
    ,NULL
    ,"SignedMonth"
    ,"Obligation.2014"
    ,"Competition.sum"
    ,"SubCustomer.component"
    ,"USDATL"
    ,"StartDate"
    ,"EndDate"
    ,MovingAverage=6
    )

CompGraph<-CompGraph+aes(size=y.variable)
# CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
    theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year")) 
CompGraph
print(CompGraph)
#     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
while(!(dev.cur()[[1]]==1)){
    dev.off()
    }

```



```{r USDATLannualComponents}        

png(
    paste( "Output\\Competition\\",paste("DoD_components"
                                         ,"Obligation_2014"
                                         ,"Competition_sum"
                                         ,"USDATL"
                                         ,"Annual"
                                         ,sep="_"
                                         )
           ,".png"
           , sep=""
           )
    , type="cairo"
    , width=7.5
    , height=10
    , units='in'
    , pointsize=12
    , res=150
    )

# debug(LatticePercentLineWrapper)

CompGraph<-LatticePercentLineWrapper(
    "Competition"
    ,""#Competition by DoD Component and Starting Regime"
    ,"Fiscal Year of Obligation"
    ,"% of Component Obligations"
    ,Coloration
    ,USDATL
    ,NULL
    ,"Fiscal.Year"
    ,"Obligation.2014"
    ,"Competition.sum"
    ,"SubCustomer.component"
    ,"USDATL"
    ,"StartDate"
    ,"EndDate"
    )

CompGraph<-CompGraph+aes(size=y.variable)
# CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
    theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
CompGraph
print(CompGraph)
#     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
while(!(dev.cur()[[1]]==1)){
    dev.off()
    }

```




```{r USDATLAnnual}        

# 
# png(
#     paste( "Output\\Competition\\", 
#            paste("DoD_components"
#                  ,"Obligation_2014"
#                  ,"Competition_sum"
#                  ,"USDATL"
#                  ,"Annual"
#                  ,sep="_"
#                  )
#            ,".png"
#            , sep=""
#            )
#     , type="cairo"
#     , width=7.5
#     , height=10
#     , units='in'
#     , pointsize=12
#     , res=150
#     )
# 
# # debug(LatticePercentLineWrapper)
# 
# CompGraph<-LatticePercentLineWrapper(
#     "Competition"
#     ,"Competition by DoD Component and Starting Regime"
#     ,"Fiscal Year of Obligation"
#     ,"% of Component Obligations"
#     ,Coloration
# 
# 
#     ,USDATL
#     ,NULL
#     ,"Fiscal.Year"
#     ,"Obligation.2014"
#     ,"Competition.sum"
#     ,"SubCustomer.component"
#     ,"USDATL"
#     ,"StartDate"
#     ,"EndDate"
#     )
# 
# CompGraph<-CompGraph+aes(size=y.variable)
# # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
#     CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
# CompGraph<-CompGraph+scale_y_continuous(limits=c(0,1),labels = percent_format())+
#     theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
#     scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
# CompGraph
#     print(CompGraph)
# #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
# while(!(dev.cur()[[1]]==1)){
#     dev.off()
#     }

```




```{r USDATLAnnualComponentsEffective}        
png(
    paste( "Output\\Competition\\", 
           paste("DoD_components"
                 ,"Obligation_2014"
                 ,"Comp_Effective"
                 ,"USDATL"
                 ,"Annual"
                 ,sep="_"
                 )
           ,".png"
           , sep=""
           )
    , type="cairo"
    , width=7.5
    , height=10
    , units='in'
    , pointsize=12
    , res=150
    )

# debug(LatticePercentLineWrapper)

CompGraph<-LatticePercentLineWrapper(
    "Competition"
    ,"Competition by DoD Component and Starting Regime"
    ,"Fiscal Year of Obligation"
    ,"% of Component Obligations"
    ,Coloration


    ,USDATL
    ,NULL
    ,"Fiscal.Year"
    ,"Obligation.2014"
    ,"Competition.effective.only"
    ,"SubCustomer.component"
    ,"USDATL"
    ,"StartDate"
    ,"EndDate"
    )

CompGraph<-CompGraph+aes(size=y.variable)
# CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
    CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
CompGraph<-CompGraph+scale_y_continuous(limits=c(0,1),labels = percent_format())+
    theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
CompGraph
    print(CompGraph)
#     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
while(!(dev.cur()[[1]]==1)){
    dev.off()
    }





png(
    paste( "Output\\Competition\\", 
           paste("DoD_components"
                 ,"Obligation_2014"
                 ,"Comp_Effective"
                 ,"USDATL"
                 ,"Annual"
                 ,sep="_"
                 )
           ,".png"
           , sep=""
           )
    , type="cairo"
    , width=7.5
    , height=10
    , units='in'
    , pointsize=12
    , res=150
    )

# debug(LatticePercentLineWrapper)

CompGraph<-LatticePercentLineWrapper(
    VAR.color.legend.label="Competition"
    ,VAR.main.label="Competition by DoD Component and Starting Regime"
    ,VAR.X.label="Fiscal Year of Obligation"
    ,VAR.Y.label="% of Component Obligations"
    ,VAR.Coloration=Coloration


    ,VAR.long.DF=USDATL
    ,VAR.ncol=1
    ,VAR.x.variable="Fiscal.Year"
    ,VAR.y.variable="Obligation.2014"
    ,VAR.y.series="Competition.effective.only"
     ,VAR.facet.primary="USDATL"
    ,VAR.facet.secondary=NA
    ,"StartDate"
    ,"EndDate"
    )

CompGraph<-CompGraph+aes(size=y.variable)
# CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
    CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
CompGraph<-CompGraph+scale_y_continuous(limits=c(0,1),labels = percent_format())+
    theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
CompGraph
    print(CompGraph)
#     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
```

```{r CompATLpolicy}
Policy<-RawRegime
Policy$ATLpolicy<-as.character(RawRegime$USDATL)
Policy$ATLpolicy[Policy$USDATL=="CARTER"]<-"CARTER\npre-BBP"
Policy$ATLpolicy[Policy$BBP1==1]<-"BBP1"
Policy$ATLpolicy[Policy$BBP2==1]<-"BBP2"
Policy$ATLpolicy[Policy$BBP3==1]<-"BBP3"

Policy$ATLpolicy<-factor(Policy$ATLpolicy,levels=c("GANSLER+","ALDRIDGE","WYNNE","KRIEG","YOUNG", "CARTER\npre-BBP","BBP1","BBP2","BBP3" ),ordered=TRUE )
# 
# ATLpolicyFYear<-aggregate(Policy$Obligation.2014
#                           , by=list(Policy$Fiscal.Year,
#                                     #                                                   RawRegime$SubCustomer.component,
#                                     Policy$ATLpolicy)
#                           ,FUN = "sum"
#                           ,na.rm =TRUE
#                           )
# 
# 
# 
# names(ATLpolicyFYear)<-c("Fiscal.Year","ATLpolicy","AnnualPolicyObligations")
# Policy<-subset(Policy,join(Policy,ATLpolicyFYear)$AnnualPolicyObligations>=50)
# 

ATLpolicyDetails<-data.frame(ATLpolicy= 'GANSLER+',
                             StartDate=as.Date('1997/11/10',format='%Y/%m/%d'),
                             EndDate=as.Date('2001/05/10',format='%Y/%m/%d'))
ATLpolicyDetails<-rbind(ATLpolicyDetails,data.frame(ATLpolicy= 'ALDRIDGE',
                                                    StartDate=as.Date('2001/05/10',format='%Y/%m/%d'),
                                                    EndDate=as.Date('2003/05/22' ,format='%Y/%m/%d') ))
ATLpolicyDetails<-rbind(ATLpolicyDetails,data.frame(ATLpolicy= 'WYNNE',
                                                    StartDate=as.Date('2003/05/23' ,format='%Y/%m/%d'),
                                                    EndDate=as.Date('2005/06/05' ,format='%Y/%m/%d')))
ATLpolicyDetails<-rbind(ATLpolicyDetails,data.frame(ATLpolicy= 'KRIEG',
                                                    StartDate=as.Date('2005/06/06' ,format='%Y/%m/%d'),
                                                    EndDate=as.Date('2007/07/19' ,format='%Y/%m/%d')))
ATLpolicyDetails<-rbind(ATLpolicyDetails,data.frame(ATLpolicy= 'YOUNG',
                                                    StartDate=as.Date('2007/07/20' ,format='%Y/%m/%d'),
                                                    EndDate=as.Date('2009/04/26',format='%Y/%m/%d')))
ATLpolicyDetails<-rbind(ATLpolicyDetails,data.frame(ATLpolicy= 'CARTER\npre-BBP',
                                                    StartDate=as.Date('2009/04/27',format='%Y/%m/%d'),
                                                    EndDate=as.Date('2010/11/02',format='%Y/%m/%d')))
ATLpolicyDetails<-rbind(ATLpolicyDetails,data.frame(ATLpolicy= 'BBP1',
                                                    StartDate=as.Date('2010/11/03',format='%Y/%m/%d'),
                                                    EndDate=as.Date('2013/04/23',format='%Y/%m/%d')))
# ATLpolicyDetails<-rbind(ATLpolicyDetails,data.frame(ATLpolicy= 'WSARA regs',
#                                                     StartDate=as.Date('2011/03/16',format='%Y/%m/%d'),
#                                                     EndDate=as.Date('2013/04/23',format='%Y/%m/%d')))
ATLpolicyDetails<-rbind(ATLpolicyDetails,data.frame(ATLpolicy= 'BBP2',
                                                    StartDate=as.Date('2013/04/24',format='%Y/%m/%d'),
                                                    EndDate=as.Date('2014/09/18',format='%Y/%m/%d')))
ATLpolicyDetails<-rbind(ATLpolicyDetails,data.frame(ATLpolicy= 'BBP3',
                                                    StartDate=as.Date('2014/09/19',format='%Y/%m/%d'),
                                                    EndDate=max(RawRegime$SignedQuarter)))


ATLpolicyDetails$StartFiscalYear<-ymd(paste(year(ATLpolicyDetails$StartDate)+
                                                ifelse(month(ATLpolicyDetails$StartDate)<10,-1,0)
                                            ,"-10-1",sep=""))

Policy<-join(Policy,ATLpolicyDetails,match="first")
Policy<-subset(Policy,ATLpolicy!='BBP3') #Not enough to include
Policy$SignedSemiAnnual[Policy$SignedSemiAnnual>Policy$EndDate&
                                      Policy$SignedMonth<=Policy$EndDate]<-
    Policy$EndDate[Policy$SignedSemiAnnual>Policy$EndDate&
                                      Policy$SignedMonth<=Policy$EndDate]
Policy$SignedSemiAnnual[Policy$SignedSemiAnnual<Policy$StartDate]<-
    Policy$StartDate[Policy$SignedSemiAnnual<Policy$StartDate]

Policy$Fiscal.Year[Policy$Fiscal.Year>Policy$EndDate&
                                      Policy$SignedMonth<=Policy$EndDate]<-
    Policy$EndDate[Policy$Fiscal.Year>Policy$EndDate&
                                      Policy$SignedMonth<=Policy$EndDate]
Policy$SignedFiscal.Year[Policy$SignedFiscal.Year<Policy$StartDate]<-
    Policy$StartDate[Policy$SignedFiscal.Year<Policy$StartDate]



```

```{r PolicyMonthlyComponents}        

png(
    paste( "Output\\Competition\\",paste("DoD_components"
                                         ,"Obligation_2014"
                                         ,"Competition_sum"
                                         ,"ATLpolicy"
                                         ,"6monthMovingAverage"
                                         ,sep="_"
                                         )
           ,".png"
           , sep=""
           )
    , type="cairo"
    , width=7.5
    , height=10
    , units='in'
    , pointsize=12
    , res=150
    )


CompGraph<-LatticePercentLineWrapper(
    "Competition"
    ,""#Competition by DoD Component and Starting Regime"
    ,"Month of Obligation (6 Month Lagging Average)"
    ,"% of Component Obligations"
    ,Coloration
    ,Policy
    ,NULL
    ,"SignedMonth"
    ,"Obligation.2014"
    ,"Competition.sum"
    ,"SubCustomer.component"
    ,"ATLpolicy"
    ,"StartDate"
    ,"EndDate"
    ,MovingAverage=6
    )

CompGraph<-CompGraph+aes(size=y.variable)
# CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
    theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
CompGraph
print(CompGraph)
#     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
while(!(dev.cur()[[1]]==1)){
    dev.off()
    }

```


```{r PolicyAnnualComponents}

png(
    paste( "Output\\Competition\\",
           paste("DoD_components"
                 ,"Obligation_2014"
                 ,"Competition_sum"
                 ,"ATLpolicy"
                 ,"Annual"
                 ,sep="_"
                 )
           ,".png"
           , sep=""
           )
    , type="cairo"
    , width=7.5
    , height=10
    , units='in'
    , pointsize=12
    , res=150
    )


CompGraph<-LatticePercentLineWrapper(
    "Competition"
    ,""#Competition by DoD Component and Starting Regime"
    ,"Fiscal Year of Obligation"
    ,"% of Component Obligations"
    ,Coloration
    ,Policy
    ,NULL
    ,"Fiscal.Year"
    ,"Obligation.2014"
    ,"Competition.sum"
    ,"SubCustomer.component"
    ,"ATLpolicy"
    ,"StartDate"
    ,"EndDate"
    )

CompGraph<-CompGraph+aes(size=y.variable)
# CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
    theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
CompGraph
print(CompGraph)
#     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
while(!(dev.cur()[[1]]==1)){
    dev.off()
    }


```

```{r PolicyMonthlySummary}


png(
    paste( "Output\\Competition\\",
           paste("DoD_Summary"
                 ,"Obligation_2014"
                 ,"Competition_sum"
                 ,"ATLpolicy"
                 ,"6monthMovingAverage"
                 ,sep="_"
                 )
           ,".png"
           , sep=""
           )
    , type="cairo"
    , width=7.5
    , height=3.5
    , units='in'
    , pointsize=12
    , res=150
    )


CompGraph<-LatticePercentLineWrapper(
    VAR.color.legend.label="Competition"
    ,""#VAR.main.label=""#Overall DoD Competition by Starting Regime"
    ,VAR.X.label="Month of Obligation (6 Month Lagging Average)"
    ,VAR.Y.label="% of DoD Obligations"
    ,VAR.Coloration=Coloration
    
    
    ,VAR.long.DF=Policy
    ,VAR.ncol=NA
    ,VAR.x.variable="SignedMonth"
    ,VAR.y.variable="Obligation.2014"
    ,VAR.y.series=    "Competition.sum"
    ,VAR.facet.primary="ATLpolicy"
    ,VAR.facet.secondary=NA
    ,"StartDate"
    ,"EndDate"
    ,MovingAverage=6
    )

CompGraph<-CompGraph+aes(size=y.variable)
# CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
    theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
CompGraph
print(CompGraph)
#     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
while(!(dev.cur()[[1]]==1)){
    dev.off()
    }


```



```{r PolicyAnnualSummary}


png(
    paste( "Output\\Competition\\",
           paste("DoD_Summary"
                 ,"Obligation_2014"
                 ,"Competition_sum"
                 ,"ATLpolicy"
                 ,"Annual"
                 ,sep="_"
                 )
           ,".png"
           , sep=""
           )
    , type="cairo"
    , width=7.5
    , height=3.5
    , units='in'
    , pointsize=12
    , res=150
    )


CompGraph<-LatticePercentLineWrapper(
    VAR.color.legend.label="Competition"
    ,""#VAR.main.label=""#Overall DoD Competition by Starting Regime"
    ,VAR.X.label="Fiscal Year of Obligation"
    ,VAR.Y.label="% of DoD Obligations"
    ,VAR.Coloration=Coloration
    
    
    ,VAR.long.DF=Policy
    ,VAR.ncol=NA
    ,VAR.x.variable="Fiscal.Year"
    ,VAR.y.variable="Obligation.2014"
    ,VAR.y.series=    "Competition.sum"
    ,VAR.facet.primary="ATLpolicy"
    ,VAR.facet.secondary=NA
    ,"StartDate"
    ,"EndDate"
    )

CompGraph<-CompGraph+aes(size=y.variable)
# CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
    theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
CompGraph
print(CompGraph)
#     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
while(!(dev.cur()[[1]]==1)){
    dev.off()
    }


```



```{r PolicyMonthlyComponentSolitary}

for (c in unique(Policy$SubCustomer)){    
    png(
        paste( "Output\\Competition\\",c,"\\",paste(
            c
            ,"Obligation_2014"
            ,"Competition_sum"
            ,"ATLpolicy"
            ,"6monthMovingAverage"
            ,sep="_"
            )
            ,".png"
            , sep=""
            )
        , type="cairo"
        , width=10
        , height=5
        , units='in'
        , pointsize=12
        , res=150
        )
    
    CompGraph<-LatticePercentLineWrapper(
        VAR.color.legend.label="Competition"
        ,VAR.main.label=""#paste(c,"Competition by Starting Regime")
        ,VAR.X.label="Month of Obligation (6 Month Lagging Average)"
        ,VAR.Y.label=paste("% of ",c," Obligations")
        ,VAR.Coloration=Coloration
        
        
        ,VAR.long.DF=subset(Policy,SubCustomer==c)
        ,VAR.ncol=NA
        ,VAR.x.variable="SignedMonth"
        ,VAR.y.variable="Obligation.2014"
        ,VAR.y.series=    "Competition.sum"
        ,VAR.facet.primary="ATLpolicy"
        ,VAR.facet.secondary=NA
        ,"StartDate"
        ,"EndDate"
        ,MovingAverage=6
        )
    
    CompGraph<-CompGraph+aes(size=y.variable)+scale_size_continuous(name="Constant 2014 $ Obligated, Billions")
    # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
    CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
    CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
        theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
        scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
    CompGraph
    print(CompGraph)
    rm(CompGraph)
    #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
    while(!(dev.cur()[[1]]==1)){
        dev.off()
        }
    }


```


```{r PolicyAnnualComponentSolitary}

for (c in unique(Policy$SubCustomer)){    
    png(
        paste("Output\\Competition\\",c,"\\",
              paste(
            c
            ,"Obligation_2014"
            ,"Competition_sum"
            ,"ATLpolicy"
            ,"Annual"
            ,sep="_"
            )
            ,".png"
            , sep=""
            )
        , type="cairo"
        , width=10
        , height=5
        , units='in'
        , pointsize=12
        , res=150
        )
    
    CompGraph<-LatticePercentLineWrapper(
        VAR.color.legend.label="Competition"
        ,VAR.main.label=""#paste(c,"Competition by Starting Regime")
        ,VAR.X.label="Fiscal Year of Obligation"
        ,VAR.Y.label=paste("% of ",c," Obligations")
        ,VAR.Coloration=Coloration
        
        
        ,VAR.long.DF=subset(Policy,SubCustomer==c)
        ,VAR.ncol=NA
        ,VAR.x.variable="Fiscal.Year"
        ,VAR.y.variable="Obligation.2014"
        ,VAR.y.series=    "Competition.sum"
        ,VAR.facet.primary="ATLpolicy"
        ,VAR.facet.secondary=NA
        ,"StartDate"
        ,"EndDate"
        )
    
    CompGraph<-CompGraph+aes(size=y.variable)+scale_size_continuous(name="Constant 2014 $ Obligated, Billions")
    # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
    CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
    CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
        theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
        scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
    CompGraph
    print(CompGraph)
    rm(CompGraph)
    #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
    while(!(dev.cur()[[1]]==1)){
        dev.off()
        }
    }


```


```{r PrepareHorseTail}

Policy$SinceFirstFiscalYear<-as.numeric(as.duration(
    ymd(Policy$SignedMonth)-Policy$StartFiscalYear)
    /dyears(1)
    )


USDATL$SinceFirstFiscalYear<-as.numeric(as.duration(
    ymd(USDATL$SignedMonth)-USDATL$StartFiscalYear)
    /dyears(1)
    )

HorseTailYears<-6


```



```{r PolicySeriesHorseTailSummary}

OldGraph<-Policy$Graph

for (s in unique(Policy$Competition.effective.only)){    
    png(
        paste( "Output\\Competition\\",
               paste(
                   "DoD"
                   ,"Category"
                   ,"Percent"
                   ,s
                   ,"Comp_Effective"
                   ,"HorseTail"
                   ,"3monthMovingAverage"
                   ,sep="_"
                   )
               ,".png"
               , sep=""
               )
        , type="cairo"
        , width=7.5
        , height=4
        , units='in'
        , pointsize=12
        , res=150
        )
    
    Policy$Graph[Policy$Competition.effective.only!=s]<-FALSE
    Policy$Graph[Policy$Competition.effective.only==s]<-TRUE
    
    CompGraph<-LatticePercentLineWrapper(
        VAR.color.legend.label="Competition"
        ,""#VAR.main.label=""#Overall DoD Competition by Starting Regime"
        ,VAR.X.label="Years Since Start of Regime's First Fiscal Year\n(3 Month Lagging Average)"
        ,VAR.Y.label="% of DoD Obligations"
        ,VAR.Coloration=Coloration
        , HorseTail=TRUE
        
        ,VAR.long.DF=Policy
        ,VAR.ncol=1
        ,VAR.x.variable="SinceFirstFiscalYear"#SignedMonth
        ,VAR.y.variable="Obligation.2014"
        ,VAR.y.series=    "ATLpolicy"
        ,VAR.facet.primary="Competition.effective.only"
        ,VAR.facet.secondary=NA
        #     ,"StartDate"
        #     ,"EndDate"
        ,MovingAverage=3
        ,MovingSides=1
        )
    
    # CompGraph<-CompGraph+aes(size=y.variable)
    
    CompGraph<-CompGraph+scale_x_continuous(breaks=c(0:HorseTailYears),limits=c(0,HorseTailYears))
    
    # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
    # CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
    CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
        theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1),legend.box='horizontal',legend.direction="vertical")+guides(color=guide_legend(ncol=2))
#     +
    #     scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
    CompGraph
    print(CompGraph)
    #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
    while(!(dev.cur()[[1]]==1)){
        dev.off()
        }
    }

Policy$Graph<-OldGraph

```


```{r PolicySeriesHorseTailComponents}

OldGraph<-Policy$Graph

for (s in unique(Policy$Competition.effective.only)){    
    png(
        paste( "Output\\Competition\\",
               paste(
                   "DoD_components"
                   ,"Category"
                   ,"Percent"
                   ,s
                   ,"Comp_Effective"
                   ,"HorseTail"
                   ,"3monthMovingAverage"
                   ,sep="_"
                   )
               ,".png"
               , sep=""
               )
        , type="cairo"
        , width=7.5
        , height=10
        , units='in'
        , pointsize=12
        , res=150
        )
    
    Policy$Graph[Policy$Competition.effective.only!=s]<-FALSE
    Policy$Graph[Policy$Competition.effective.only==s]<-TRUE
    
    CompGraph<-LatticePercentLineWrapper(
        VAR.color.legend.label="Competition"
        ,""#VAR.main.label=""#Overall DoD Competition by Starting Regime"
        ,VAR.X.label="Years Since Start of Regime's First Fiscal Year\n(3 Month Lagging Average)"
        ,VAR.Y.label="% of Component Obligations"
        ,VAR.Coloration=Coloration
        , HorseTail=TRUE
        
        ,VAR.long.DF=Policy
        ,VAR.ncol=1
        ,VAR.x.variable="SinceFirstFiscalYear"#SignedMonth
        ,VAR.y.variable="Obligation.2014"
        ,VAR.y.series=    "ATLpolicy"
        ,VAR.facet.primary="Competition.effective.only"
        ,VAR.facet.secondary="SubCustomer"
        #     ,"StartDate"
        #     ,"EndDate"
        ,MovingAverage=3
        ,MovingSides=1
        )
    
    # CompGraph<-CompGraph+aes(size=y.variable)
    CompGraph<-CompGraph+scale_x_continuous(breaks=c(0:HorseTailYears),
                                                limits=c(0,HorseTailYears))
    
    # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
    # CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
    CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
        theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1),legend.box='horizontal',legend.direction="vertical")+guides(color=guide_legend(ncol=2))
    #     scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
    CompGraph
    print(CompGraph)
    #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
    while(!(dev.cur()[[1]]==1)){
        dev.off()
        }
    }

Policy$Graph<-OldGraph

```


```{r PolicySeriesSpendingBarSummary}


OldGraph<-Policy$Graph

for (s in unique(Policy$Competition.effective.only)){    
    png(
        paste( "Output\\Competition\\",
               paste(
                   "DoD"
                   ,"Category"
                   ,"Obligation_2014"
                   ,s
                   ,"Comp_Effective"
                   ,"Bar"
                   ,"3monthMovingAverage"
                   ,sep="_"
                   )
               ,".png"
               , sep=""
               )
        , type="cairo"
        , width=7.5
        , height=4
        , units='in'
        , pointsize=12
        , res=150
        )
    
    Policy$Graph[Policy$Competition.effective.only!=s]<-FALSE
    Policy$Graph[Policy$Competition.effective.only==s]<-TRUE
    
    CompGraph<-LatticePlotWrapper(
        VAR.color.legend.label="Competition"
        ,""#VAR.main.label=""#Overall DoD Competition by Starting Regime"
        ,VAR.X.label="Years Since Start of Regime's First Fiscal Year\n(3 Month Lagging Average)"
        ,VAR.Y.label=paste(s,"Constant 2014 $ Obligated, Billions")
        ,VAR.Coloration=Coloration
        ,VAR.long.DF=Policy
        ,VAR.ncol=1
        ,VAR.x.variable="SinceFirstFiscalYear"#SignedMonth
        ,VAR.y.variable="Obligation.2014"
        ,VAR.y.series="ATLpolicy"
        ,VAR.facet.primary="ATLpolicy"
        ,VAR.facet.secondary=NA
        #     ,"StartDate"
        #     ,"EndDate"
        ,MovingAverage=3
        ,MovingSides=1
        )
    CompGraph<-CompGraph+geom_bar(width=1/12,stat="identity",position="dodge")
    # CompGraph<-CompGraph+aes(size=y.variable)
    
    CompGraph<-CompGraph+scale_x_continuous(breaks=c(0:HorseTailYears),
                                                limits=c(0,HorseTailYears))
    
    # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
    # CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
    # CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
    #     theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    #     scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
    CompGraph
    print(CompGraph)
    #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
    while(!(dev.cur()[[1]]==1)){
        dev.off()
        }
    }

Policy$Graph<-OldGraph

```



```{r PolicySeriesHorseTailComponentSolitary}

OldGraph<-Policy$Graph
for (c in unique(Policy$SubCustomer)){ 
    CompSubCustomer<-subset(Policy,SubCustomer==c)
    for (s in unique(Policy$Competition.effective.only)){    
        CompSubCustomer$Graph[CompSubCustomer$Competition.effective.only!=s]<-FALSE
        CompSubCustomer$Graph[CompSubCustomer$Competition.effective.only==s]<-TRUE
        if(any(CompSubCustomer$Graph==TRUE)){
            png(
                paste( "Output\\Competition\\",c,"\\",
                       paste(
                           c
                           ,"Category"
                           ,"Percent"
                           ,s
                           ,"Comp_Effective"
                           ,"HorseTail"
                           ,"3monthMovingAverage"
                           ,sep="_"
                           )
                       ,".png"
                       , sep=""
                       )
                , type="cairo"
                , width=7.5
                , height=4
                , units='in'
                , pointsize=12
                , res=150
                )
            
            
            CompGraph<-LatticePercentLineWrapper(
                VAR.color.legend.label="Competition"
                ,""#VAR.main.label=""#Overall DoD Competition by Starting Regime"
                ,VAR.X.label="Years Since Start of Regime's First Fiscal Year\n(3 Month Lagging Average)"
                ,VAR.Y.label=paste("% of",c,"Obligations")
                ,VAR.Coloration=Coloration
                , HorseTail=TRUE
                
                ,VAR.long.DF=CompSubCustomer
                ,VAR.ncol=1
                ,VAR.x.variable="SinceFirstFiscalYear"#SignedMonth
                ,VAR.y.variable="Obligation.2014"
                ,VAR.y.series=    "ATLpolicy"
                ,VAR.facet.primary="Competition.effective.only"
                ,VAR.facet.secondary=NA
                #     ,"StartDate"
                #     ,"EndDate"
                ,MovingAverage=3
                ,MovingSides=1
                )
                    
            # CompGraph<-CompGraph+aes(size=y.variable)
            
            CompGraph<-CompGraph+scale_x_continuous(breaks=c(0:HorseTailYears)
                                                        ,limits=c(0,HorseTailYears))
            
            # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
            # CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
            # CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
            #     theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1),legend.box='horizontal',legend.direction="vertical")+guides(color=guide_legend(ncol=2))+
            #     scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
            CompGraph
            print(CompGraph)
            #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
            while(!(dev.cur()[[1]]==1)){
                dev.off()
                }
            }
        }
    }
Policy$Graph<-OldGraph

```




```{r PolicySeriesSpendingBarComponentSolitary}

OldGraph<-Policy$Graph
for (c in unique(Policy$SubCustomer)){ 
    CompSubCustomer<-subset(Policy,SubCustomer==c)
    for (s in unique(Policy$Competition.effective.only)){    
        CompSubCustomer$Graph[CompSubCustomer$Competition.effective.only!=s]<-FALSE
        CompSubCustomer$Graph[CompSubCustomer$Competition.effective.only==s]<-TRUE
        if(any(CompSubCustomer$Graph==TRUE)){
    png(
        paste( "Output\\Competition\\",c,"\\",
               paste(
                   c
                   ,"Category"
                   ,"Obligation_2014"
                   ,s
                   ,"Competition_sum"
                   ,"Bar"
                   ,"3monthMovingAverage"
                   ,sep="_"
                   )
               ,".png"
               , sep=""
               )
        , type="cairo"
        , width=7.5
        , height=4
        , units='in'
        , pointsize=12
        , res=150
        )
    
    CompGraph<-LatticePlotWrapper(
        VAR.color.legend.label="Competition"
        ,""#VAR.main.label=""#Overall DoD Competition by Starting Regime"
        ,VAR.X.label="Years Since Start of Regime's First Fiscal Year\n(3 Month Lagging Average)"
        ,VAR.Y.label=paste(c,s,"Constant 2014 $ Obligated, Billions")
        ,VAR.Coloration=Coloration
        ,VAR.long.DF=CompSubCustomer
        ,VAR.ncol=1
        ,VAR.x.variable="SinceFirstFiscalYear"#SignedMonth
        ,VAR.y.variable="Obligation.2014"
        ,VAR.y.series="ATLpolicy"
        ,VAR.facet.primary="ATLpolicy"
        ,VAR.facet.secondary=NA
        #     ,"StartDate"
        #     ,"EndDate"
        ,MovingAverage=3
        ,MovingSides=1
        ,DataLabels=FALSE
        )
#     browser()
    CompGraph<-CompGraph+geom_bar(width=1/12,stat="identity",position="dodge")
    # CompGraph<-CompGraph+aes(size=y.variable)
    
    CompGraph<-CompGraph+scale_x_continuous(breaks=c(0:HorseTailYears)
                                                ,limits=c(0,HorseTailYears))
    
    # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
    # CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
    # CompGraph<-CompGraph+coord_cartesian(ylim=c(0, 1))+scale_y_continuous(labels = percent_format())+
    #     theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    #     scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
    CompGraph
    print(CompGraph)
    #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
    while(!(dev.cur()[[1]]==1)){
        dev.off()
        }
    }

        }
    }
Policy$Graph<-OldGraph

```


```{r PolicyAnnualComponentsOld}
# 
# 
# png(
#     paste("Output\\Competition\\", 
#           paste("DoD_components"
#                  ,"Obligation_2014"
#                  ,"Competition_sum"
#                  ,"ATLpolicy"
#                  ,"Annual"
#                  ,sep="_"
#                  )
#            ,".png"
#            , sep=""
#            )
#     , type="cairo"
#     , width=7.5
#     , height=10
#     , units='in'
#     , pointsize=12
#     , res=150
#     )
# 
# 
# CompGraph<-LatticePercentLineWrapper(
#     "Competition"
#     ,"Competition by DoD Component and Starting Regime"
#     ,"Fiscal Year of Obligation"
#     ,"% of Component Obligations"
#     ,Coloration
# 
# 
#     ,Policy
#     ,NULL
#     ,"Fiscal.Year"
#     ,"Obligation.2014"
#     ,"Competition.sum"
#     ,"SubCustomer.component"
#     ,"ATLpolicy"
#     ,"StartDate"
#     ,"EndDate"
#     )
# 
# CompGraph<-CompGraph+aes(size=y.variable)
# # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
#     CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
# CompGraph<-CompGraph+scale_y_continuous(limits=c(0,1),labels = percent_format())+
#     theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
#     scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
# CompGraph
#     print(CompGraph)
# #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
# while(!(dev.cur()[[1]]==1)){
#     dev.off()
#     }

```




```{r PolicyAnnualSummaryOld}

# 
# 
# png(
#     paste( "Output\\Competition\\", 
#            paste("DoD_Summary"
#                  ,"Obligation_2014"
#                  ,"Competition_sum"
#                  ,"ATLpolicy"
#                  ,"Annual"
#                  ,sep="_"
#                  )
#            ,".png"
#            , sep=""
#            )
#     , type="cairo"
#     , width=7.5
#     , height=3.5
#     , units='in'
#     , pointsize=12
#     , res=150
#     )
# 
# CompGraph<-LatticePercentLineWrapper(
#     VAR.color.legend.label="Competition"
#     ,VAR.main.label="Overall DoD Competition by Starting Regime"
#     ,VAR.X.label="Fiscal Year of Obligation"
#     ,VAR.Y.label="% of Component Obligations"
#     ,VAR.Coloration=Coloration
# 
# 
#     ,VAR.long.DF=Policy
#     ,VAR.ncol=4
#     ,VAR.x.variable="Fiscal.Year"
#     ,VAR.y.variable="Obligation.2014"
#     ,VAR.y.series=    "Competition.sum"
#      ,VAR.facet.primary="ATLpolicy"
#     ,VAR.facet.secondary=NA
#     ,"StartDate"
#     ,"EndDate"
#     )
# 
# CompGraph<-CompGraph+aes(size=y.variable)
# # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
#     CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate
#                                        , xmax=EndDate
#                                        , ymin=-Inf
#                                        , ymax=Inf
#                                        )
#                                    ,color="red",alpha=0,size=1)
# CompGraph<-CompGraph+scale_y_continuous(limits=c(0,1),labels = percent_format())+
#     theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
#     scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
# CompGraph
#     print(CompGraph)
# #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
# while(!(dev.cur()[[1]]==1)){
#     dev.off()
#     }


```


```{r PolicyAnnualComponentSolitaryOld}
# for (s in unique(Policy$SubCustomer)){    
#     png(
#         paste("Output\\Competition\\", 
#               paste(s
#                      ,"Obligation_2014"
#                      ,"Competition_sum"
#                      ,"ATLpolicy"
#                      ,"Annual"
#                      ,sep="_"
#                      )
#                ,".png"
#                , sep=""
#                )
#         , type="cairo"
#         , width=10
#         , height=5
#         , units='in'
#         , pointsize=12
#         , res=150
#         )
#     
#     CompGraph<-LatticePercentLineWrapper(
#         VAR.color.legend.label="Competition"
#         ,VAR.main.label=""#paste(s,"Competition by Starting Regime")
#         ,VAR.X.label="Fiscal Year of Obligation"
#         ,VAR.Y.label="% of Component Obligations"
#         ,VAR.Coloration=Coloration
#         
#         
#         ,VAR.long.DF=subset(Policy,SubCustomer==s)
#         ,VAR.ncol=4
#         ,VAR.x.variable="Fiscal.Year"
#         ,VAR.y.variable="Obligation.2014"
#         ,VAR.y.series=    "Competition.sum"
#         ,VAR.facet.primary="ATLpolicy"
#         ,VAR.facet.secondary=NA
#         ,"StartDate"
#         ,"EndDate"
#         )
#     CompGraph<-CompGraph+aes(size=y.variable)+scale_size_continuous(name="Constant 2014 $ Obligated, Billions")
#     # CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
#     CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate
#                                        , xmax=EndDate
#                                        , ymin=-Inf
#                                        , ymax=Inf
#                                        , size = 0),color="red",alpha=0,size=1)
#     CompGraph<-CompGraph+scale_y_continuous(limits=c(0,1),labels = percent_format())+
#         theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
#         scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
#     CompGraph
#     print(CompGraph)
#     rm(CompGraph)
#     #     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
#     while(!(dev.cur()[[1]]==1)){
#         dev.off()
#         }
#     }

```


```{r PolicyAnnualEffective}
png(
    paste( "Output\\Competition\\", 
           paste("DoD_components"
                 ,"Obligation_2014"
                 ,"Comp_Effective"
                 ,"ATLpolicy"
                 ,"Annual"
                 ,sep="_"
                 )
           ,".png"
           , sep=""
           )
    , type="cairo"
    , width=7.5
    , height=10
    , units='in'
    , pointsize=12
    , res=150
    )


CompGraph<-LatticePercentLineWrapper(
    "Competition"
    ,"Competition by DoD Component and Starting Regime"
    ,"Fiscal Year of Obligation"
    ,"% of Component Obligations"
    ,Coloration


    ,Policy
    ,NULL
    ,"Fiscal.Year"
    ,"Obligation.2014"
    ,"Competition.effective.only"
    ,"SubCustomer.component"
    ,"ATLpolicy"
    ,"StartDate"
    ,"EndDate"
    )

CompGraph<-CompGraph+aes(size=y.variable)
# CompGraph+geom_vline(aes(xintercept=as.numeric(StartDate)))+geom_vline(aes(xintercept=as.numeric(EndDate)))
    CompGraph<-CompGraph+geom_rect(aes(xmin=StartDate, xmax=EndDate, ymin=-Inf, ymax=Inf),color="red",alpha=0,size=1)
CompGraph<-CompGraph+scale_y_continuous(limits=c(0,1),labels = percent_format())+
    theme(legend.position="bottom",axis.text.x = element_text(angle = 90, hjust = 1))+
    scale_x_date(labels=date_format("'%y"),breaks=date_breaks("year"))
CompGraph
    print(CompGraph)
#     CompGraph+scale_fill_manual(values = alpha(c("red","blue"), .3))
while(!(dev.cur()[[1]]==1)){
    dev.off()
    }


```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.







```{r DataTables}

#Annual
USDATLTable<-ddply(USDATL, 
                         .(
                             Fiscal.Year,
                             SinceFirstFiscalYear,
                             Competition.sum,
                             Competition.effective.only,
                             SubCustomer.component,
                             USDATL
                             ),
                         summarize,
                         Obligation.2014=sum(Obligation.2014)
                         )

write.csv(USDATLTable,paste("Output\\Competition\\",
                                  paste("DoD_components"
                                        ,"Obligation_2014"
                                        ,"Competition_sum"
                                        ,"USDATL"
                                        ,"Annual"
                                        ,sep="_"
                                        )
                                  ,".csv",
                                  sep=""))



#Monthly
USDATLTable<-ddply(USDATL, 
                         .(
                             SignedMonth,
                             SignedQuarter,
                             Quarter,
                             Fiscal.Year,
                             SinceFirstFiscalYear,
                             Competition.sum,
                             Competition.effective.only,
                             SubCustomer.component,
                             USDATL
                             ),
                         summarize,
                         Obligation.2014=sum(Obligation.2014)
                         )


USDATLTable<-ddply(USDATLTable, 
                         .( Competition.sum,
                            Competition.effective.only,
                           SubCustomer.component,
                           USDATL),
                         .fun=TransformFilter,
                         MovingAverage=3,
                         MovingSides=1,
                         Source="Obligation.2014"
                         )



write.csv(USDATLTable,paste("Output\\Competition\\",
                                  paste("DoD_components"
                                        ,"Obligation_2014"
                                        ,"Competition_sum"
                                        ,"USDATL"
                                        ,"Monthly"
                                        ,sep="_"
                                        )
                                  ,".csv",
                                  sep=""))




#Quarterly
USDATLTable<-ddply(USDATLTable, 
                         .(  SignedQuarter,
                             Quarter,
                             Fiscal.Year,
                             SinceFirstFiscalYear,
                             Competition.sum,
                             Competition.effective.only,
                             SubCustomer.component,
                             USDATL
                             ),
                         summarize,
                         Obligation.2014=sum(Obligation.2014),
                         MovingAverage=sum(MovingAverage)
                         )


write.csv(USDATLTable,paste("Output\\Competition\\",
                                  paste("DoD_components"
                                        ,"Obligation_2014"
                                        ,"Competition_sum"
                                        ,"USDATL"
                                        ,"Quarterly"
                                        ,sep="_"
                                        )
                                  ,".csv",
                                  sep=""))






#Annual
PolicyTable<-ddply(Policy, c("Fiscal.Year"
                                             ,"SinceFirstFiscalYear"
                                         ,"Competition.sum"
                             ,"Competition.effective.only"
                                         ,"SubCustomer.component"
                                         ,"ATLpolicy")
                         ,summarise
                         ,Obligation.2014=sum(Obligation.2014)
                         )


write.csv(PolicyTable,paste("Output\\Competition\\",
                                  paste("DoD_components"
                                        ,"Obligation_2014"
                                        ,"Competition_sum"
                                        ,"ATLpolicy"
                                        ,"Annual"
                                        ,sep="_"
                                        )
                                  ,".csv",
                                  sep=""))


#Monthly

PolicyTable<-ddply(Policy, c("SignedMonth"
                                             ,"SignedQuarter"
                                             ,"Quarter"
                                             ,"Fiscal.Year"
                                             ,"SinceFirstFiscalYear"
                                         ,"Competition.sum"
                             ,"Competition.effective.only"
                                         ,"SubCustomer.component"
                                         ,"ATLpolicy")
                         ,summarise
                         ,Obligation.2014=sum(Obligation.2014)
                         )

PolicyTable<-ddply(PolicyTable, 
                         .( Competition.sum,
                            Competition.effective.only,
                           SubCustomer.component,
                           ATLpolicy),
                         .fun=TransformFilter,
                         MovingAverage=3,
                         MovingSides=1,
                         Source="Obligation.2014"
                         )


write.csv(PolicyTable,paste("Output\\Competition\\",
                                  paste("DoD_components"
                                        ,"Obligation_2014"
                                        ,"Competition_sum"
                                        ,"ATLpolicy"
                                        ,"Monthly"
                                        ,sep="_"
                                        )
                                  ,".csv",
                                  sep=""))


#Quarterly
PolicyTable<-ddply(PolicyTable, 
                         .(  SignedQuarter,
                             Quarter,
                             Fiscal.Year,
                             SinceFirstFiscalYear,
                             Competition.sum,
                             Competition.effective.only,
                             SubCustomer.component,
                             ATLpolicy
                             ),
                         summarize,
                         Obligation.2014=sum(Obligation.2014),
                         MovingAverage=sum(MovingAverage)
                         )


write.csv(PolicyTable,paste("Output\\Competition\\",
                                  paste("DoD_components"
                                        ,"Obligation_2014"
                                        ,"Competition_sum"
                                        ,"ATLpolicy"
                                        ,"Quarterly"
                                        ,sep="_"
                                        )
                                  ,".csv",
                                  sep=""))


```